[include mainsail.cfg]
# Include printer specific file
[include manta-a8p.cfg]

# need to have values that klipper can change, such as pid calib data, in printer.cfg
# Motor8
[extruder]
step_pin: PC7
dir_pin: PC8
enable_pin: !PD2
microsteps: 16
rotation_distance: 33.600
nozzle_diameter: 0.4
filament_diameter: 1.75
heater_pin: PA0 # HE0
sensor_pin: PB0 # T0
sensor_type: Generic 3950
control: pid
# see motor5 for original values 
#pid_Kp: 2.151492
#pid_Ki: 0.633897
#pid_Kd: 230.042965
pid_Kp=32.408
pid_Ki=1.500
pid_Kd=175.005
min_temp: 0
max_temp: 250

[heater_bed]   
heater_pin: PA1 # HE1
sensor_pin: PB1 # TB
sensor_type: Generic 3950
control: pid
pid_Kp=73.181
pid_Ki=1.211
pid_Kd=1105.940
min_temp: 0
max_temp: 100


####################################################################

[gcode_macro START_PRINT]
gcode:
    {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(200)|float %}
    # Start bed heating
    M140 S{BED_TEMP}
    # Use absolute coordinates
    G90
    # Reset the G-Code Z offset (adjust Z offset if needed)
    SET_GCODE_OFFSET Z=0.0
    # Home the printer
    G28
    # Move the nozzle near the bed
    G1 Z5 F3000
    # Move the nozzle very close to the bed
    G1 Z0.15 F300
    # Wait for bed to reach temperature
    M190 S{BED_TEMP}
    # Set and wait for nozzle to reach temperature
    M109 S{EXTRUDER_TEMP}

[gcode_macro END_PRINT]
gcode:
    # Turn off bed, extruder, and fan
    M140 S0
    M104 S0
    M106 S0
    # Move nozzle away from print while retracting
    G91
    G1 X-2 Y-2 E-3 F300
    # Raise nozzle by 10mm
    G1 Z10 F3000
    G90
    # Disable steppers
    M84

#######################################################################
